---
// Enhanced SEO component with WCAG 2.2 AA compliance
// Includes breadcrumbs, Schema.org JSON-LD, and structured metadata

interface BreadcrumbItem {
  name: string;
  href?: string;
}

export interface Props {
  // Core SEO props
  title: string;
  description: string;
  url?: string | URL;
  image?: { src: string; alt: string };
  robots?: boolean;
  frontmatter?: any;

  // Schema.org props
  schemaType?: 'WebPage' | 'Article' | 'Product' | 'Organization';
  breadcrumbs?: BreadcrumbItem[];

  // Additional metadata
  keywords?: string[];
  author?: string;
  publishedTime?: Date;
  modifiedTime?: Date;
}

const siteData = {
  name: "Premium Hosting",
  url: "https://premium-hosting.co.uk",
  description: "Premium web hosting solutions for UK businesses - fast, secure, and reliable hosting services.",
  image: {
    src: "/premium-hosting-og.png",
    alt: "Premium Hosting - UK Business Web Hosting"
  },
  organization: {
    name: "Premium Hosting",
    url: "https://premium-hosting.co.uk",
    logo: "https://premium-hosting.co.uk/premium-hosting-horizontal-logo.svg",
    email: "support@premium-hosting.co.uk",
    phone: "+44 20 1234 5678",
    address: {
      streetAddress: "123 Business Street",
      addressLocality: "London",
      postalCode: "EC1A 1BB",
      addressCountry: "GB"
    }
  }
};

const {
  title,
  description,
  url = Astro.url,
  image,
  frontmatter,
  robots,
  schemaType = frontmatter ? "Article" : "WebPage",
  breadcrumbs = [],
  keywords = [],
  author,
  publishedTime,
  modifiedTime
} = Astro.props;

// Build canonical URL
const canonicalUrl = typeof url === 'string' ? url : url.pathname;

// Generate breadcrumbs
function generateBreadcrumbs(crumbs: BreadcrumbItem[]) {
  if (crumbs.length === 0) return null;

  const breadcrumbJsonLd = {
    "@context": "https://schema.org",
    "@type": "BreadcrumbList",
    "itemListElement": [
      {
        "@type": "ListItem",
        "position": 1,
        "name": "Home",
        "item": siteData.url
      },
      ...crumbs.map((crumb, index) => ({
        "@type": "ListItem",
        "position": index + 2,
        "name": crumb.name,
        "item": crumb.href ? `${siteData.url}${crumb.href}` : undefined
      }))
    ]
  };

  return [breadcrumbJsonLd];
}

// Generate main Schema.org markup
function generateSchemaMarkup() {
  const schemas = [];

  // Organization schema
  schemas.push({
    "@context": "https://schema.org",
    "@type": "Organization",
    "@id": `${siteData.url}#organization`,
    "name": siteData.organization.name,
    "url": siteData.organization.url,
    "logo": siteData.organization.logo,
    "email": siteData.organization.email,
    "telephone": siteData.organization.phone,
    "address": {
      "@type": "PostalAddress",
      ...siteData.organization.address
    }
  });

  // Website schema
  schemas.push({
    "@context": "https://schema.org",
    "@type": "WebSite",
    "@id": `${siteData.url}#website`,
    "name": siteData.name,
    "url": siteData.url,
    "publisher": {
      "@id": `${siteData.url}#organization`
    },
    "potentialAction": {
      "@type": "SearchAction",
      "target": `${siteData.url}/search?q={search_term_string}`,
      "query-input": "required name=search_term_string"
    }
  });

  // Page/WebPage schema
  const pageSchema = {
    "@context": "https://schema.org",
    "@type": schemaType,
    "@id": canonicalUrl,
    "url": canonicalUrl,
    "name": title,
    "description": description,
    "isPartOf": {
      "@id": `${siteData.url}#website`
    },
    "publisher": {
      "@id": `${siteData.url}#organization`
    },
    "image": image ? image.src : siteData.image.src,
    "inLanguage": "en-GB"
  };

  // Add article-specific properties
  if (schemaType === "Article" && frontmatter) {
    pageSchema["headline"] = title;
    if (author) pageSchema["author"] = {"@type": "Person", "name": author};
    if (publishedTime) pageSchema["datePublished"] = publishedTime.toISOString();
    if (modifiedTime) pageSchema["dateModified"] = modifiedTime.toISOString();
    pageSchema["mainEntityOfPage"] = {
      "@type": "WebPage",
      "@id": canonicalUrl
    };
  }

  schemas.push(pageSchema);

  // Add breadcrumbs if provided
  const breadcrumbSchemas = generateBreadcrumbs(breadcrumbs);
  if (breadcrumbSchemas) {
    schemas.push(...breadcrumbSchemas);
  }

  return schemas;
}

// Generate JSON-LD script
function generateJsonLdScript() {
  const schemas = generateSchemaMarkup();
  return schemas.map(schema => `<script type="application/ld+json">${JSON.stringify(schema, null, 0)}</script>`).join('');
}
---

<!-- Canonical URL and basic meta -->
<link rel="canonical" href={canonicalUrl} />
<meta name="description" content={description} />
<meta name="keywords" content={keywords.join(', ')} />

<!-- Open Graph / Facebook -->
<meta property="og:type" content={schemaType === "Article" ? "article" : "website"} />
<meta property="og:site_name" content={siteData.name} />
<meta property="og:title" content={title} />
<meta property="og:description" content={description} />
<meta property="og:url" content={canonicalUrl} />
<meta property="og:image" content={image?.src || siteData.image.src} />
<meta property="og:image:secure_url" content={image?.src || siteData.image.src} />
<meta property="og:image:alt" content={image?.alt || siteData.image.alt} />
<meta property="og:image:type" content="image/png" />
<meta property="og:image:width" content="1200" />
<meta property="og:image:height" content="630" />
<meta property="og:locale" content="en_GB" />

<!-- Twitter -->
<meta property="twitter:card" content="summary_large_image" />
<meta property="twitter:site" content="@PremiumHosting" />
<meta property="twitter:title" content={title} />
<meta property="twitter:description" content={description} />
<meta property="twitter:image" content={image?.src || siteData.image.src} />
<meta property="twitter:image:alt" content={image?.alt || siteData.image.alt} />

<!-- Article specific meta -->
{publishedTime && <meta property="article:published_time" content={publishedTime.toISOString()} />}
{modifiedTime && <meta property="article:modified_time" content={modifiedTime.toISOString()} />}
{publishedTime && <meta property="article:author" content={author || siteData.name} />}

<!-- Robots and additional settings -->
{robots ? (
  <meta name="robots" content="noindex, nofollow" />
) : (
  <meta name="robots" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1" />
)}

<meta name="googlebot" content="index, follow" />
<meta name="bingbot" content="index, follow" />

<!-- Accessibility and performance hints -->
<meta name="format-detection" content="telephone=yes" />
<meta name="theme-color" content="#D4AF37" />
<meta name="color-scheme" content="light dark" />

<!-- DNS prefetch for performance -->
<link rel="dns-prefetch" href="//fonts.googleapis.com" />
<link rel="dns-prefetch" href="//www.google-analytics.com" />

<!-- Schema.org JSON-LD Structured Data -->
<Fragment set:html={generateJsonLdScript()} />

<!-- Breadcrumb Navigation (visible breadcrumbs for users) -->
{breadcrumbs.length > 0 && (
  <nav aria-label="Breadcrumb" class="breadcrumb-nav">
    <ol class="breadcrumb-list">
      <li class="breadcrumb-item">
        <a href="/">Home</a>
      </li>
      {breadcrumbs.map((crumb, index) => (
        <li class="breadcrumb-item" key={index}>
          {crumb.href ? (
            <a href={crumb.href}>{crumb.name}</a>
          ) : (
            <span aria-current="page">{crumb.name}</span>
          )}
        </li>
      ))}
    </ol>
  </nav>
)}

<style>
  .breadcrumb-nav {
    margin: 1rem 0;
    font-size: 0.875rem;
  }

  .breadcrumb-list {
    display: flex;
    align-items: center;
    list-style: none;
    margin: 0;
    padding: 0;
    gap: 0.5rem;
  }

  .breadcrumb-item:not(:last-child)::after {
    content: "/";
    margin-left: 0.5rem;
    color: var(--text-color);
    opacity: 0.6;
  }

  .breadcrumb-item a {
    color: var(--text-color);
    text-decoration: none;
    transition: color 0.15s ease;
  }

  .breadcrumb-item a:hover {
    color: var(--gold);
    text-decoration: underline;
  }

  .breadcrumb-item a:focus {
    outline: 2px solid var(--gold);
    outline-offset: 2px;
  }

  [aria-current="page"] {
    color: var(--text-color);
    font-weight: 500;
  }
</style>
